<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï°∞ Ìé∏ÏÑ± ÌîÑÎ°úÍ∑∏Îû®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            overflow-x: hidden;
            zoom: 0.8;
        }

        /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ */
        .main-layout {
            display: flex;
            gap: 20px;
            padding: 10px;
            height: calc(130vh - 120px);
        }

        /* ÏôºÏ™Ω 30% Ìå®ÎÑê */
        .left-panel {
            width: 35%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .panel-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            padding: 15px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .section-header h3 {
            margin: 0;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }

        .controls-inline {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 12px;
        }

        .count-input {
            padding: 6px 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 12px;
            width: 50px;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 11px;
        }

        .panel-section h3 {
            margin-bottom: 12px;
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }

        .number-area {
            background-color: #f8fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 6px;
            padding: 16px;
            min-height: 187px;
            transition: all 0.3s ease;
        }

        .number-area.drag-over {
            border-color: #3b82f6;
            background-color: #dbeafe;
        }

        .gender-split {
            display: flex;
            gap: 10px;
        }

        .gender-box {
            flex: 1;
            border: 2px dashed #cbd5e0;
            border-radius: 6px;
            padding: 26px;
            min-height: 350px;
            transition: all 0.3s ease;
        }

        .gender-box.male {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        .gender-box.female {
            background-color: #fce7f3;
            border-color: #ec4899;
        }

        .gender-box.drag-over {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .gender-box h4 {
            margin-bottom: 21px;
            font-size: 31px;
            font-weight: 600;
            text-align: center;
        }

        .gender-box.male h4 {
            color: #1d4ed8;
        }

        .gender-box.female h4 {
            color: #be185d;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(10, minmax(30px, 1fr));
            gap: 5px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Ïò§Î•∏Ï™Ω 70% Ìå®ÎÑê */
        .right-panel {
            width: 65%;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 25px;
            overflow-y: auto;
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .team-header h1 {
            color: #1e293b;
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .team-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        /* Ï°∞Î≥Ñ Ïπ¥Îìú (Í∞ÑÎã®Ìïú ÎîîÏûêÏù∏) */
        .team {
            border: none;
            border-radius: 12px;
            padding: 20px;
            min-height: 600px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .team::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 12px 12px 0 0;
        }

        /* Ï°∞Î≥Ñ ÏÉâÏÉÅ ÌÖåÎßà */
        .team:nth-child(1) { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .team:nth-child(1)::before { background: #3b82f6; }
        .team:nth-child(2) { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); }
        .team:nth-child(2)::before { background: #10b981; }
        .team:nth-child(3) { background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%); }
        .team:nth-child(3)::before { background: #f59e0b; }
        .team:nth-child(4) { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); }
        .team:nth-child(4)::before { background: #ec4899; }
        .team:nth-child(5) { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); }
        .team:nth-child(5)::before { background: #8b5cf6; }
        .team:nth-child(6) { background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); }
        .team:nth-child(6)::before { background: #06d6a0; }
        .team:nth-child(7) { background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%); }
        .team:nth-child(7)::before { background: #ef4444; }
        .team:nth-child(8) { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); }
        .team:nth-child(8)::before { background: #0ea5e9; }
        .team:nth-child(9) { background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); }
        .team:nth-child(9)::before { background: #d97706; }
        .team:nth-child(10) { background: linear-gradient(135deg, #f7fee7 0%, #ecfccb 100%); }
        .team:nth-child(10)::before { background: #65a30d; }

        .team:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .team.drag-over {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 25px rgba(59, 130, 246, 0.3);
        }

        .team-title {
            text-align: center;
            margin-bottom: 15px;
        }

        .team .team-title h4 {
            margin: 0;
            color: #1e293b;
            font-size: 24px !important;
            font-weight: 700;
        }

        .team-members {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            min-height: 240px;
            align-items: flex-start;
            align-content: flex-start;
        }

        /* Ìó§Îçî Ïä§ÌÉÄÏùº */
        .header {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0 0 4px 0;
            font-size: 20px;
            color: #333;
            display: flex;
            align-items: center;
        }

        .header h1::before {
            content: "üë•";
            margin-right: 10px;
            font-size: 24px;
        }

        .header-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        .btn {
            padding: 8px 14px;
            margin: 3px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }



        .student-number {
            background-color: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            padding: 7px 13px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s ease;
            font-weight: 600;
            user-select: none;
            min-width: 44px;
            font-size: 18px;
        }

        .student-number:hover {
            background-color: #e2e8f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .student-number.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        /* Ï°∞Î≥Ñ Ìé∏ÏÑ± ÏòÅÏó≠ (ÌïòÎã®) */
        .team-assignment {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .team-assignment h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
            font-size: 16px;
        }

        .teams-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .team {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 15px;
            min-height: 120px;
            transition: all 0.3s ease;
            background-color: #f8fafc;
        }

        .team.drag-over {
            border-color: #3b82f6;
            background-color: #dbeafe;
        }

        .team h4 {
            text-align: center;
            margin-bottom: 10px;
            color: #374151;
            font-size: 14px;
        }

        .team-members {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
        }

        .member-number {
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 36px;
            font-weight: 600;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
            color: white;
        }

        /* ÏÑ±Î≥ÑÎ≥Ñ ÏÉâÏÉÅ */
        .member-number.male {
            background-color: #3b82f6;
        }

        .member-number.female {
            background-color: #ec4899;
        }

        /* ÏÑ±Î≥ÑÏù¥ ÏßÄÏ†ïÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ Í∏∞Î≥∏ ÏÉâÏÉÅ */
        .member-number:not(.male):not(.female) {
            background-color: #6b7280;
        }

        .member-number.male:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }

        .member-number.female:hover {
            background-color: #be185d;
            transform: translateY(-1px);
        }

        .member-number:not(.male):not(.female):hover {
            background-color: #4b5563;
            transform: translateY(-1px);
        }

        .member-number.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }



        .team-count-input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            width: 80px;
        }


        /* ÌïôÏÉù Î≤àÌò∏ ÏòÅÏó≠ (ÏÉÅÎã®) */
        .student-numbers-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .student-numbers-section h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .student-count-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .student-numbers-container {
            display: flex;
            gap: 20px;
            max-width: 70%;
            margin: 0 auto;
        }

        .student-numbers {
            background-color: #f8fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
            transition: all 0.3s ease;
            flex: 1;
        }

        .student-numbers.drag-over {
            border-color: #3b82f6;
            background-color: #dbeafe;
        }

        .unassigned-area {
            background-color: #fef3c7;
            border: 2px dashed #f59e0b;
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .unassigned-area.drag-over {
            border-color: #d97706;
            background-color: #fef3c7;
            transform: scale(1.02);
        }

        .unassigned-area h4 {
            margin-bottom: 10px;
            color: #92400e;
            font-size: 14px;
        }


        /* ÏÑ±Î≥Ñ Íµ¨Î∂Ñ ÏòÅÏó≠ (Ï§ëÍ∞Ñ) */
        .gender-division {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .gender-division h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .gender-areas {
            display: flex;
            gap: 20px;
        }

        .gender-area {
            flex: 1;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            min-height: 100px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .gender-area.male {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        .gender-area.female {
            background-color: #fce7f3;
            border-color: #ec4899;
        }

        .gender-area.drag-over {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .gender-area h4 {
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: 600;
        }

        .gender-area.male h4 {
            color: #1d4ed8;
        }

        .gender-area.female h4 {
            color: #be185d;
        }

        .gender-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
        }

        .gender-number {
            border-radius: 5px;
            padding: 5px 11px;
            font-size: 18px;
            font-weight: 600;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .gender-number.male {
            background-color: #3b82f6;
            color: white;
        }

        .gender-number.female {
            background-color: #ec4899;
            color: white;
        }

        .gender-number:hover {
            transform: translateY(-1px);
        }

        .gender-number.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Ï°∞ Ìé∏ÏÑ± ÌîÑÎ°úÍ∑∏Îû®</h1>
        <div class="header-buttons">
            <button class="btn btn-warning" onclick="resetAll()">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
            <div class="dropdown" style="position: relative; display: inline-block;">
                <button class="btn btn-info" onclick="toggleLoadMenu()">Î∂àÎü¨Ïò§Í∏∞ ‚ñº</button>
                <div id="loadMenu" class="dropdown-content" style="display: none; position: absolute; background-color: white; min-width: 160px; box-shadow: 0px 8px 16px rgba(0,0,0,0.2); z-index: 1; border-radius: 4px; right: 0; top: 100%; margin-top: 5px;">
                    <a href="#" onclick="loadAssignment()" style="color: black; padding: 8px 12px; text-decoration: none; display: block; font-size: 13px;">JSON Î∂àÎü¨Ïò§Í∏∞</a>
                    <a href="#" onclick="loadFromCSV()" style="color: black; padding: 8px 12px; text-decoration: none; display: block; font-size: 13px;">CSV Î∂àÎü¨Ïò§Í∏∞</a>
                </div>
            </div>
            <div class="dropdown" style="position: relative; display: inline-block;">
                <button class="btn btn-success" onclick="toggleSaveMenu()">Ï†ÄÏû• ‚ñº</button>
                <div id="saveMenu" class="dropdown-content" style="display: none; position: absolute; background-color: white; min-width: 160px; box-shadow: 0px 8px 16px rgba(0,0,0,0.2); z-index: 1; border-radius: 4px; right: 0; top: 100%; margin-top: 5px;">
                    <a href="#" onclick="saveAsText()" style="color: black; padding: 8px 12px; text-decoration: none; display: block; font-size: 13px;">ÌÖçÏä§Ìä∏ ÌååÏùº Îã§Ïö¥Î°úÎìú</a>
                    <a href="#" onclick="saveAsCSV()" style="color: black; padding: 8px 12px; text-decoration: none; display: block; font-size: 13px;">CSV ÌååÏùº Îã§Ïö¥Î°úÎìú</a>
                    <a href="#" onclick="saveAsJSON()" style="color: black; padding: 8px 12px; text-decoration: none; display: block; font-size: 13px;">Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ (JSON)</a>
                </div>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <!-- ÏôºÏ™Ω 30%: ÌïôÏÉù Í¥ÄÎ¶¨ -->
        <div class="left-panel">
            <!-- ÌïôÏÉù Î≤àÌò∏ -->
            <div class="panel-section">
                <div class="section-header">
                    <h3>üìã ÌïôÏÉù Î≤àÌò∏</h3>
                    <div class="controls-inline">
                        <input type="number" id="studentCount" class="count-input" value="35" min="1" max="50">
                        <button class="btn btn-sm btn-primary" onclick="updateStudentCount()">Î≥ÄÍ≤Ω</button>
                    </div>
                </div>
                <div class="number-area">
                    <div class="numbers-grid" id="numbersGrid">
                        <!-- ÌïôÏÉù Î≤àÌò∏Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>

            <!-- ÎÇ®ÎÖÄ Íµ¨Î∂Ñ -->
            <div class="panel-section">
                <h3>üë´ ÎÇ®ÎÖÄ Íµ¨Î∂Ñ</h3>
                <div class="gender-split">
                    <div class="gender-box male" data-gender="male">
                        <h4>üë¶ ÎÇ®ÌïôÏÉù</h4>
                        <div class="gender-numbers" id="male-numbers">
                            <!-- ÎÇ®ÌïôÏÉù Î≤àÌò∏Îì§ -->
                        </div>
                    </div>
                    <div class="gender-box female" data-gender="female">
                        <h4>üëß Ïó¨ÌïôÏÉù</h4>
                        <div class="gender-numbers" id="female-numbers">
                            <!-- Ïó¨ÌïôÏÉù Î≤àÌò∏Îì§ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ïò§Î•∏Ï™Ω 70%: Ï°∞Î≥Ñ Ìé∏ÏÑ± -->
        <div class="right-panel">
            <div class="team-header">
                <h1>üèÜ Ï°∞Î≥Ñ Ìé∏ÏÑ±</h1>
                <div class="team-controls">
                    <label>Ï°∞ Í∞úÏàò:</label>
                    <input type="number" id="teamCount" class="count-input" value="6" min="1" max="10">
                    <button class="btn btn-primary" onclick="updateTeams()">Î≥ÄÍ≤Ω</button>
                    <button class="btn btn-success" onclick="autoAssignBalanced()">ÏûêÎèô Ìé∏ÏÑ±</button>
                    <button class="btn btn-warning" onclick="shuffleAll()">Ïû¨Ìé∏ÏÑ±</button>
                </div>
            </div>
            
            <div class="teams-grid" id="teamsContainer">
                <!-- Ï°∞Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let draggedElement = null;
        let teams = [];
        let availableNumbers = [];
        let maleStudents = [];
        let femaleStudents = [];
        let totalStudents = 35;


        // Ï¥àÍ∏∞Ìôî
        function init() {
            generateStudentNumbers();
            updateTeams();
            setupGenderAreas();
            updateGenderDisplay();
        }





        // ÏÑ±Î≥Ñ Íµ¨Î∂Ñ ÏòÅÏó≠ ÏÑ§Ï†ï
        function setupGenderAreas() {
            document.querySelectorAll('.gender-box').forEach(area => {
                area.addEventListener('dragover', handleGenderDragOver);
                area.addEventListener('drop', handleGenderDrop);
                area.addEventListener('dragleave', handleGenderDragLeave);
            });
        }

        // ÏÑ±Î≥Ñ Î≤àÌò∏ ÎìúÎûòÍ∑∏ ÏãúÏûë
        function handleGenderDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
        }

        // ÏÑ±Î≥Ñ Î≤àÌò∏ ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å
        function handleGenderDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }

        // ÏÑ±Î≥Ñ ÏòÅÏó≠ ÎìúÎûòÍ∑∏ Ïò§Î≤Ñ
        function handleGenderDragOver(e) {
            e.preventDefault();
            // ÌïôÏÉù Î≤àÌò∏, ÏÑ±Î≥Ñ Î≤àÌò∏, ÎòêÎäî Î©§Î≤Ñ Î≤àÌò∏ÏóêÏÑú ÎìúÎûòÍ∑∏Ìïú Í≤ΩÏö∞Îßå ÌóàÏö©
            if (draggedElement && (draggedElement.classList.contains('student-number') || 
                                   draggedElement.classList.contains('gender-number') ||
                                   draggedElement.classList.contains('member-number'))) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        // ÏÑ±Î≥Ñ ÏòÅÏó≠ ÎìúÎûòÍ∑∏ Îñ†ÎÇ®
        function handleGenderDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        // ÏÑ±Î≥Ñ ÏòÅÏó≠ ÎìúÎ°≠
        function handleGenderDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedElement) {
                const studentNumber = parseInt(draggedElement.dataset.number);
                const targetGender = e.currentTarget.dataset.gender;
                
                // Í∏∞Ï°¥ ÏÑ±Î≥ÑÏóêÏÑú Ï†úÍ±∞
                maleStudents = maleStudents.filter(num => num !== studentNumber);
                femaleStudents = femaleStudents.filter(num => num !== studentNumber);
                
                // ÏÉà ÏÑ±Î≥ÑÏóê Ï∂îÍ∞Ä
                if (targetGender === 'male') {
                    maleStudents.push(studentNumber);
                } else {
                    femaleStudents.push(studentNumber);
                }
                
                // ÌåÄÏóêÏÑúÎèÑ Ï†úÍ±∞ (Ïù¥ÎØ∏ Î∞∞Ï†ïÎêú Í≤ΩÏö∞)
                if (draggedElement.dataset.team !== undefined) {
                    const fromTeamIndex = parseInt(draggedElement.dataset.team);
                    teams[fromTeamIndex].members = teams[fromTeamIndex].members.filter(num => num !== studentNumber);
                    teams.forEach((_, index) => updateTeamDisplay(index));
                }
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateGenderDisplay();
                generateStudentNumbers();
            }
        }

        // ÌïôÏÉù Ïàò Î≥ÄÍ≤Ω
        function updateStudentCount() {
            const newCount = parseInt(document.getElementById('studentCount').value);
            if (newCount < 1 || newCount > 50) {
                alert('ÌïôÏÉù ÏàòÎäî 1Î™ÖÏóêÏÑú 50Î™Ö ÏÇ¨Ïù¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (newCount < totalStudents) {
                // ÌïôÏÉù ÏàòÍ∞Ä Ï§ÑÏñ¥Îì§ Îïå - Ï¥àÍ≥º ÌïôÏÉù Ï†úÍ±∞
                for (let i = newCount + 1; i <= totalStudents; i++) {
                    maleStudents = maleStudents.filter(num => num !== i);
                    femaleStudents = femaleStudents.filter(num => num !== i);
                    teams.forEach(team => {
                        team.members = team.members.filter(num => num !== i);
                    });
                }
            }
            
            totalStudents = newCount;
            generateStudentNumbers();
            updateGenderDisplay();
            updateUnassignedDisplay();
            teams.forEach((_, index) => updateTeamDisplay(index));
        }

        // ÌïôÏÉù Î≤àÌò∏ ÏÉùÏÑ±
        function generateStudentNumbers() {
            const numbersGrid = document.getElementById('numbersGrid');
            const studentNumbersPanel = document.querySelector('.number-area');
            numbersGrid.innerHTML = '';
            availableNumbers = [];

            // ÌïôÏÉù Î≤àÌò∏ Ìå®ÎÑêÏóê ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä (Ìïú Î≤àÎßå)
            if (studentNumbersPanel && !studentNumbersPanel.hasAttribute('data-drop-enabled')) {
                studentNumbersPanel.addEventListener('dragover', handleStudentPanelDragOver);
                studentNumbersPanel.addEventListener('drop', handleStudentPanelDrop);
                studentNumbersPanel.addEventListener('dragleave', handleStudentPanelDragLeave);
                studentNumbersPanel.setAttribute('data-drop-enabled', 'true');
            }

            for (let i = 1; i <= totalStudents; i++) {
                if (!isNumberAssigned(i) && !isNumberGenderAssigned(i)) {
                    availableNumbers.push(i);
                    const numberDiv = document.createElement('div');
                    numberDiv.className = 'student-number';
                    numberDiv.draggable = true;
                    numberDiv.textContent = i;
                    numberDiv.dataset.number = i;

                    // ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                    numberDiv.addEventListener('dragstart', handleDragStart);
                    numberDiv.addEventListener('dragend', handleDragEnd);

                    numbersGrid.appendChild(numberDiv);
                }
            }
        }

        // ÏÑ±Î≥Ñ Ìï†Îãπ Ïó¨Î∂Ä ÌôïÏù∏
        function isNumberGenderAssigned(number) {
            return maleStudents.includes(number) || femaleStudents.includes(number);
        }

        // ÏÑ±Î≥Ñ Íµ¨Î∂Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateGenderDisplay() {
            const maleContainer = document.getElementById('male-numbers');
            const femaleContainer = document.getElementById('female-numbers');
            
            // ÌåÄÏóê Î∞∞Ï†ïÎêú ÌïôÏÉùÎì§ÏùÄ Ï†úÏô∏ÌïòÍ≥† ÌëúÏãú
            const assignedNumbers = [];
            teams.forEach(team => {
                assignedNumbers.push(...team.members);
            });
            
            // ÎÇ®ÌïôÏÉù ÌëúÏãú (ÌåÄÏóê Î∞∞Ï†ïÎêòÏßÄ ÏïäÏùÄ ÌïôÏÉùÎßå)
            maleContainer.innerHTML = maleStudents
                .filter(num => !assignedNumbers.includes(num))
                .sort((a, b) => a - b)
                .map(num => `<span class="gender-number male" draggable="true" data-number="${num}" data-gender="male">${num}</span>`)
                .join('');
            
            // Ïó¨ÌïôÏÉù ÌëúÏãú (ÌåÄÏóê Î∞∞Ï†ïÎêòÏßÄ ÏïäÏùÄ ÌïôÏÉùÎßå)
            femaleContainer.innerHTML = femaleStudents
                .filter(num => !assignedNumbers.includes(num))
                .sort((a, b) => a - b)
                .map(num => `<span class="gender-number female" draggable="true" data-number="${num}" data-gender="female">${num}</span>`)
                .join('');
            
            // ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            document.querySelectorAll('.gender-number').forEach(element => {
                element.addEventListener('dragstart', handleGenderDragStart);
                element.addEventListener('dragend', handleGenderDragEnd);
            });
        }

        // Î≤àÌò∏Í∞Ä Ïù¥ÎØ∏ Î∞∞Ï†ïÎêòÏóàÎäîÏßÄ ÌôïÏù∏
        function isNumberAssigned(number) {
            return teams.some(team => team.members.includes(number));
        }

        // Ï°∞ Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateTeams() {
            const teamCount = parseInt(document.getElementById('teamCount').value);
            const teamsContainer = document.getElementById('teamsContainer');
            
            // Í∏∞Ï°¥ ÌåÄ Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥ÌïòÎ©¥ÏÑú ÌåÄ Í∞úÏàò Ï°∞Ï†ï
            while (teams.length < teamCount) {
                teams.push({ members: [] });
            }
            while (teams.length > teamCount) {
                // Ï†úÍ±∞ÎêòÎäî ÌåÄÏùò Î©§Î≤ÑÎì§ÏùÑ Îã§Ïãú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î≤àÌò∏Î°ú ÎêòÎèåÎ¶º
                const removedTeam = teams.pop();
                // Î≤àÌò∏ Í∑∏Î¶¨Îìú ÏÉàÎ°úÍ≥†Ïπ®ÏùÄ ÎÇòÏ§ëÏóê Ìïú Î≤àÎßå
            }

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            teamsContainer.innerHTML = '';
            teams.forEach((team, index) => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'team';
                teamDiv.dataset.teamIndex = index;

                // ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                teamDiv.addEventListener('dragover', handleDragOver);
                teamDiv.addEventListener('drop', handleDrop);
                teamDiv.addEventListener('dragleave', handleDragLeave);

                teamsContainer.appendChild(teamDiv);
            });

            // Î™®Îì† Ï°∞Ïùò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            teams.forEach((_, index) => updateTeamDisplay(index));
            
            generateStudentNumbers(); // Î≤àÌò∏ Í∑∏Î¶¨Îìú ÏÉàÎ°úÍ≥†Ïπ®
        }

        // ÎìúÎûòÍ∑∏ ÏãúÏûë
        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
        }

        // ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }

        // Î©§Î≤Ñ ÎìúÎûòÍ∑∏ ÏãúÏûë
        function handleMemberDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.stopPropagation(); // Ïù¥Î≤§Ìä∏ Î≤ÑÎ∏îÎßÅ Î∞©ÏßÄ
        }

        // Î©§Î≤Ñ ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å
        function handleMemberDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }

        // ÎìúÎûòÍ∑∏ Ïò§Î≤Ñ
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        // ÎìúÎûòÍ∑∏ Îñ†ÎÇ®
        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        // ÎìúÎ°≠
        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedElement) {
                const teamIndex = parseInt(e.currentTarget.dataset.teamIndex);
                const studentNumber = parseInt(draggedElement.dataset.number);
                
                // Í∏∞Ï°¥ ÌåÄÏóêÏÑú Ï†úÍ±∞ (Î©§Î≤ÑÏóêÏÑú ÎìúÎûòÍ∑∏Ìïú Í≤ΩÏö∞)
                if (draggedElement.dataset.team !== undefined) {
                    const fromTeamIndex = parseInt(draggedElement.dataset.team);
                    teams[fromTeamIndex].members = teams[fromTeamIndex].members.filter(num => num !== studentNumber);
                    updateTeamDisplay(fromTeamIndex);
                }
                
                // ÏÑ±Î≥Ñ Íµ¨Î∂ÑÏóêÏÑú ÎìúÎûòÍ∑∏Ìïú Í≤ΩÏö∞ - ÏÑ±Î≥Ñ Ï†ïÎ≥¥Îäî Ïú†ÏßÄÌïòÍ≥† UIÏóêÏÑúÎßå Ï†úÍ±∞
                if (draggedElement.classList.contains('gender-number')) {
                    // ÏÑ±Î≥Ñ Î∞∞Ïó¥ÏóêÏÑúÎäî Ï†úÍ±∞ÌïòÏßÄ ÏïäÍ≥† ÏÑ±Î≥Ñ Ï†ïÎ≥¥ Ïú†ÏßÄ
                    // Îã®ÏßÄ UIÎßå ÏóÖÎç∞Ïù¥Ìä∏
                }
                
                // ÏÉà ÌåÄÏóê ÌïôÏÉù Ï∂îÍ∞Ä
                teams[teamIndex].members.push(studentNumber);
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateTeamDisplay(teamIndex);
                updateGenderDisplay(); // ÏÑ±Î≥Ñ ÌëúÏãúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                generateStudentNumbers(); // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î≤àÌò∏ ÏÉàÎ°úÍ≥†Ïπ®
            }
        }

        // ÌïôÏÉù Î≤àÌò∏ Ìå®ÎÑê ÎìúÎûòÍ∑∏ Ïò§Î≤Ñ
        function handleStudentPanelDragOver(e) {
            e.preventDefault();
            // Î©§Î≤Ñ Î≤àÌò∏ ÎòêÎäî ÏÑ±Î≥Ñ Î≤àÌò∏ÏóêÏÑú ÎìúÎûòÍ∑∏Ìïú Í≤ΩÏö∞Îßå ÌóàÏö©
            if (draggedElement && (draggedElement.classList.contains('member-number') || draggedElement.classList.contains('gender-number'))) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        // ÌïôÏÉù Î≤àÌò∏ Ìå®ÎÑê ÎìúÎûòÍ∑∏ Îñ†ÎÇ®
        function handleStudentPanelDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        // ÌïôÏÉù Î≤àÌò∏ Ìå®ÎÑê ÎìúÎ°≠
        function handleStudentPanelDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            // Î©§Î≤Ñ Î≤àÌò∏ÏóêÏÑú ÎìúÎûòÍ∑∏Ìïú Í≤ΩÏö∞Îßå Ï≤òÎ¶¨
            if (draggedElement && draggedElement.classList.contains('member-number')) {
                const studentNumber = parseInt(draggedElement.dataset.number);
                const fromTeamIndex = parseInt(draggedElement.dataset.team);
                
                // ÌåÄÏóêÏÑú Ï†úÍ±∞
                teams[fromTeamIndex].members = teams[fromTeamIndex].members.filter(num => num !== studentNumber);
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateTeamDisplay(fromTeamIndex);
                generateStudentNumbers(); // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î≤àÌò∏ ÏÉàÎ°úÍ≥†Ïπ®
            }
            // ÏÑ±Î≥Ñ Î≤àÌò∏ÏóêÏÑú ÎìúÎûòÍ∑∏Ìïú Í≤ΩÏö∞ Ï≤òÎ¶¨
            else if (draggedElement && draggedElement.classList.contains('gender-number')) {
                const studentNumber = parseInt(draggedElement.dataset.number);
                
                // ÏÑ±Î≥Ñ Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞
                maleStudents = maleStudents.filter(num => num !== studentNumber);
                femaleStudents = femaleStudents.filter(num => num !== studentNumber);
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateGenderDisplay();
                generateStudentNumbers();
            }
        }

        // ÌïôÏÉùÏùò ÏÑ±Î≥Ñ ÌôïÏù∏ Ìï®Ïàò
        function getStudentGender(studentNumber) {
            if (maleStudents.includes(studentNumber)) {
                return 'male';
            } else if (femaleStudents.includes(studentNumber)) {
                return 'female';
            }
            return 'unknown';
        }

        // ÌåÄ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ (Í∞ÑÎã®Ìïú Î≤ÑÏ†Ñ)
        function updateTeamDisplay(teamIndex) {
            const teamDiv = document.querySelector(`[data-team-index="${teamIndex}"]`);
            if (!teamDiv) return;
            
            const team = teams[teamIndex];
            
            teamDiv.innerHTML = `
                <div class="team-title">
                    <h4>${teamIndex + 1}Ï°∞</h4>
                </div>
                <div class="team-members" id="team-${teamIndex}">
                    ${team.members.map(num => {
                        const gender = getStudentGender(num);
                        const genderClass = gender !== 'unknown' ? gender : '';
                        return `<span class="member-number ${genderClass}" draggable="true" data-number="${num}" data-team="${teamIndex}" data-gender="${gender}" onclick="removeFromTeam(${teamIndex}, ${num})">${num}</span>`;
                    }).join('')}
                </div>
            `;
            
            // ÏÉàÎ°ú ÏÉùÏÑ±Îêú Î©§Î≤Ñ Î≤àÌò∏Îì§Ïóê ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            teamDiv.querySelectorAll('.member-number').forEach(memberElement => {
                memberElement.addEventListener('dragstart', handleMemberDragStart);
                memberElement.addEventListener('dragend', handleMemberDragEnd);
            });
        }

        // ÌåÄÏóêÏÑú Ï†úÍ±∞ (ÏÑ±Î≥Ñ ÏßÄÏ†ïÏúºÎ°ú ÎêòÎèåÎ¶º)
        function removeFromTeam(teamIndex, studentNumber) {
            teams[teamIndex].members = teams[teamIndex].members.filter(num => num !== studentNumber);
            updateTeamDisplay(teamIndex);
            updateGenderDisplay();
            generateStudentNumbers();
        }

        // Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî
        function resetAll() {
            if (confirm('Î™®Îì† Ï°∞ Ìé∏ÏÑ±ÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                teams.forEach(team => team.members = []);
                maleStudents = [];
                femaleStudents = [];
                teams.forEach((_, index) => updateTeamDisplay(index));
                updateGenderDisplay();
                generateStudentNumbers();
            }
        }


        // Í∑†Îì± ÏûêÎèô Ìé∏ÏÑ±
        function autoAssignBalanced() {
            resetAll();
            
            const allNumbers = Array.from({length: 35}, (_, i) => i + 1);
            const shuffled = allNumbers.sort(() => Math.random() - 0.5);
            
            let currentTeam = 0;
            shuffled.forEach(number => {
                teams[currentTeam].members.push(number);
                currentTeam = (currentTeam + 1) % teams.length;
            });
            
            teams.forEach((_, index) => updateTeamDisplay(index));
            generateStudentNumbers();
        }

        // ÎûúÎç§ Ìé∏ÏÑ±
        function autoAssignRandom() {
            resetAll();
            
            const allNumbers = Array.from({length: 35}, (_, i) => i + 1);
            const shuffled = allNumbers.sort(() => Math.random() - 0.5);
            
            shuffled.forEach(number => {
                const randomTeam = Math.floor(Math.random() * teams.length);
                teams[randomTeam].members.push(number);
            });
            
            teams.forEach((_, index) => updateTeamDisplay(index));
            generateStudentNumbers();
        }

        // ÏÑûÏñ¥ÏÑú Ïû¨Ìé∏ÏÑ±
        function shuffleAll() {
            const allAssignedNumbers = [];
            teams.forEach(team => {
                allAssignedNumbers.push(...team.members);
                team.members = [];
            });
            
            const shuffled = allAssignedNumbers.sort(() => Math.random() - 0.5);
            let currentTeam = 0;
            shuffled.forEach(number => {
                teams[currentTeam].members.push(number);
                currentTeam = (currentTeam + 1) % teams.length;
            });
            
            teams.forEach((_, index) => updateTeamDisplay(index));
            generateStudentNumbers();
        }


        // Ï†ÄÏû• Î©îÎâ¥ ÌÜ†Í∏Ä
        function toggleSaveMenu() {
            const menu = document.getElementById('saveMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
            // Î∂àÎü¨Ïò§Í∏∞ Î©îÎâ¥Îäî Îã´Í∏∞
            document.getElementById('loadMenu').style.display = 'none';
        }

        // Î∂àÎü¨Ïò§Í∏∞ Î©îÎâ¥ ÌÜ†Í∏Ä
        function toggleLoadMenu() {
            const menu = document.getElementById('loadMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
            // Ï†ÄÏû• Î©îÎâ¥Îäî Îã´Í∏∞
            document.getElementById('saveMenu').style.display = 'none';
        }

        // Î©îÎâ¥ Îã´Í∏∞ (Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú)
        document.addEventListener('click', function(event) {
            const saveMenu = document.getElementById('saveMenu');
            const loadMenu = document.getElementById('loadMenu');
            const dropdown = event.target.closest('.dropdown');
            if (!dropdown) {
                saveMenu.style.display = 'none';
                loadMenu.style.display = 'none';
            }
        });

        // ÌÖçÏä§Ìä∏ ÌååÏùº Îã§Ïö¥Î°úÎìú
        function saveAsText() {
            const assignment = getAssignmentData();
            if (!assignment.result) {
                alert('Ìé∏ÏÑ±Îêú Ï°∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const content = `Ï°∞ Ìé∏ÏÑ± Í≤∞Í≥º\n${'='.repeat(20)}\n\n${assignment.result}\n\nÎÇ®ÌïôÏÉù: ${maleStudents.sort((a,b) => a-b).join(', ')}\nÏó¨ÌïôÏÉù: ${femaleStudents.sort((a,b) => a-b).join(', ')}`;
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ï°∞Ìé∏ÏÑ±_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('saveMenu').style.display = 'none';
        }

        // JSON Î∞±ÏóÖ ÌååÏùº Îã§Ïö¥Î°úÎìú
        function saveAsJSON() {
            const data = {
                teams: teams,
                maleStudents: maleStudents,
                femaleStudents: femaleStudents,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ï°∞Ìé∏ÏÑ±_Î∞±ÏóÖ_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('saveMenu').style.display = 'none';
        }

        // CSV ÌååÏùº Îã§Ïö¥Î°úÎìú
        function saveAsCSV() {
            const assignment = getAssignmentData();
            if (!assignment.assignment || assignment.assignment.length === 0) {
                alert('Ìé∏ÏÑ±Îêú Ï°∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // CSV Ìó§Îçî
            let csvContent = 'Ï°∞,ÌïôÏÉùÎ≤àÌò∏,ÏÑ±Î≥Ñ\n';
            
            // Í∞Å Ï°∞Î≥ÑÎ°ú Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
            assignment.assignment.forEach(team => {
                team.members.forEach(studentNum => {
                    const gender = getStudentGender(studentNum);
                    const genderText = gender === 'male' ? 'ÎÇ®' : gender === 'female' ? 'Ïó¨' : 'ÎØ∏ÏßÄÏ†ï';
                    csvContent += `${team.teamNumber}Ï°∞,${studentNum},${genderText}\n`;
                });
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ï°∞Ìé∏ÏÑ±_${new Date().toISOString().slice(0,10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('saveMenu').style.display = 'none';
        }



        // Ï°∞ Ìé∏ÏÑ± Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        function getAssignmentData() {
            const assignment = teams.map((team, index) => ({
                teamNumber: index + 1,
                members: team.members.sort((a, b) => a - b),
                maleMembers: team.members.filter(num => maleStudents.includes(num)).sort((a, b) => a - b),
                femaleMembers: team.members.filter(num => femaleStudents.includes(num)).sort((a, b) => a - b)
            })).filter(team => team.members.length > 0);
            
            const result = assignment.map(team => {
                const genderInfo = [];
                if (team.maleMembers.length > 0) genderInfo.push(`ÎÇ®: ${team.maleMembers.join(', ')}`);
                if (team.femaleMembers.length > 0) genderInfo.push(`Ïó¨: ${team.femaleMembers.join(', ')}`);
                const genderDetail = genderInfo.length > 0 ? ` (${genderInfo.join(', ')})` : '';
                return `${team.teamNumber}Ï°∞: ${team.members.join(', ')}${genderDetail}`;
            }).join('\n');
            
            return { assignment, result };
        }

        // JSON ÌååÏùºÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞
        function loadAssignment() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('ÌòÑÏû¨ ÏûëÏóÖÏùÑ ÎçÆÏñ¥Ïì∞Í≥† ÌååÏùº Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            teams = data.teams || [];
                            maleStudents = data.maleStudents || [];
                            femaleStudents = data.femaleStudents || [];
                            
                            // UI ÏóÖÎç∞Ïù¥Ìä∏
                            document.getElementById('teamCount').value = teams.length;
                            updateTeams();
                            updateGenderDisplay();
                            generateStudentNumbers();
                            
                            alert('JSON ÌååÏùºÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôÄÏ°åÏäµÎãàÎã§!');
                        }
                    } catch (error) {
                        alert('JSON ÌååÏùº Î∂àÎü¨Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
            document.getElementById('loadMenu').style.display = 'none';
        }
        
        // CSV ÌååÏùºÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞
        function loadFromCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csvText = e.target.result;
                        const lines = csvText.split('\n');
                        
                        if (lines.length < 2) {
                            alert('CSV ÌååÏùº ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                            return;
                        }
                        
                        if (confirm('ÌòÑÏû¨ ÏûëÏóÖÏùÑ ÎçÆÏñ¥Ïì∞Í≥† CSV ÌååÏùº Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            // Ï¥àÍ∏∞Ìôî
                            teams = [];
                            maleStudents = [];
                            femaleStudents = [];
                            
                            // CSV ÌååÏã± (Ï≤´ Ï§ÑÏùÄ Ìó§ÎçîÏù¥ÎØÄÎ°ú Ï†úÏô∏)
                            const teamMap = new Map();
                            
                            for (let i = 1; i < lines.length; i++) {
                                const line = lines[i].trim();
                                if (!line) continue;
                                
                                const [teamName, studentNum, gender] = line.split(',');
                                if (!teamName || !studentNum) continue;
                                
                                const teamIndex = parseInt(teamName.replace('Ï°∞', '')) - 1;
                                const num = parseInt(studentNum);
                                
                                if (isNaN(teamIndex) || isNaN(num)) continue;
                                
                                // ÌåÄ Î∞∞Ïó¥ ÌôïÏû•
                                while (teams.length <= teamIndex) {
                                    teams.push({ members: [] });
                                }
                                
                                teams[teamIndex].members.push(num);
                                
                                // ÏÑ±Î≥Ñ Ï†ïÎ≥¥ Ï†ÄÏû•
                                if (gender && gender.trim() === 'ÎÇ®') {
                                    maleStudents.push(num);
                                } else if (gender && gender.trim() === 'Ïó¨') {
                                    femaleStudents.push(num);
                                }
                            }
                            
                            // UI ÏóÖÎç∞Ïù¥Ìä∏
                            document.getElementById('teamCount').value = teams.length;
                            updateTeams();
                            updateGenderDisplay();
                            generateStudentNumbers();
                            
                            alert('CSV ÌååÏùºÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôÄÏ°åÏäµÎãàÎã§!');
                        }
                    } catch (error) {
                        alert('CSV ÌååÏùº Î∂àÎü¨Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
            document.getElementById('loadMenu').style.display = 'none';
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
